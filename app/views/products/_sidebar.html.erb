<div id="sidebar">
  <% unless @current_user_session %>
    <h4>Login</h4>

    <% form_for UserSession.new, :url => user_session_path do |f| %>
      <%= f.error_messages %>
      <%= f.label :login %><br />
      <%= f.text_field :login %><br />
      <br />
      <%= f.label :password %><br />
      <%= f.password_field :password %><br />
      <br />
      <%= f.check_box :remember_me %><%= f.label :remember_me %><br />
      <br />
      <%= f.submit "Login" %>
    <% end %>
    
    <p><%= link_to 'Forgot password?', new_password_reset_path %></p>
  <% end %>
  
  <h4>Filter Products</h4>
  <b>By Status:</b>
  <ul>
    <li><%= link_to "Available for Order (#{@facets[:statuses][:available]})", products_url(:search => @search.conditions.merge(:available_orderables_id_greater_than => 0)) %></li>
    <li><%= link_to "Any Product", products_url(:search => @search.conditions.reject{|k,v| k == :available_orderables_id_greater_than }) %></li>
  </ul>
  
  <b>By Category:</b>
  <%= category_facets(@root_categories, @facets, @search, true) %>
  
  <b>By Producer:</b>
  <ul>
    <% @facets[:accounts].each_pair do |acct, cnt| %>
    <li><%= link_to "#{acct.name} (#{cnt})", products_url(:search => @search.conditions.merge(:account_id_equals => acct.id)) %></li>
    <% end %>
    <li><%= link_to "Any Producer", products_url(:search => @search.conditions.reject{|k,v| k == :account_id_equals }) %></li>
  </ul>
  
  <h4>Producer Profiles</h4>
  <ul>
    <% @sidebar_producers.each do |prod| %>
      <li><%= link_to prod.producer_name, prod %></li>
    <% end %>
  </ul>

</div>